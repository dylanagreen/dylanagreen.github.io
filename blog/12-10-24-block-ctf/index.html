<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <link rel=icon  href="/assets/favicon.png"> <title>October, 2024 - One For Your, One For Me</title> <header> <div class=blog-name ><a href="/">Dylan Green</a></div> <nav> <ul> <li><a href="/">Home</a> <li><a href="/about/">About</a> <li><a href="/research/">Research Experience</a> <li><a href="/blog/">Blog </a> </ul> <img src="/assets/hamburger.svg" id=menu-icon > </nav> </header> <div class=franklin-content ><h1 id=blockctf_2024_retrospective ><a href="#blockctf_2024_retrospective" class=header-anchor >BlockCTF 2024 Retrospective</a></h1> <div class=franklin-toc ><ol><li><a href="#sizer_cipher_100_pts">Sizer Cipher &#40;100 pts&#41;</a><li><a href="#wheres_my_key_150_pts">Where&#39;s My Key? &#40;150 pts&#41;</a><li><a href="#glitch_in_the_crypt_exploiting_faulty_rsa_decryption_200_pts">Glitch in the Crypt: Exploiting Faulty RSA Decryption &#40;200 pts&#41;</a><li><a href="#conclusion">Conclusion</a></ol></div> <p>I still participate in CTFs about once monthly, keeps my math skills sharp considering the only category I can ever contribute to reliably is crypto &#40;since I&#39;m the only player on the team who likes math, apparently&#41;. Recently we participated in <a href="https://2024.blockctf.com/">Block CTF</a> and I cleared all three crypto challenges within the first ~14 hours. Figured I would write them up for posterity.</p> <p>I&#39;d like to get back into doing writeups more frequently, because its proven that explaining a concept helps ensure that you actually understand it, and I&#39;d like to significantly improve my cryptography skills for the more difficult CTFs.</p> <h2 id=sizer_cipher_100_pts ><a href="#sizer_cipher_100_pts" class=header-anchor >Sizer Cipher &#40;100 pts&#41;</a></h2> <blockquote> <p>I made my own encryption scheme- check it out&#33; 052c01be88c7f52cbdc3c084c7b1313828034370034dd13778342dff</p> </blockquote> <p>This is a sourceless crypto, which means it&#39;ll be slightly guessy at least until we can figure out what the cipher actually does. It&#39;s also reasonable to assume that the provided hex string is the encrypted version of the flag.</p> <p>A lot of this challenge is guessing and checking until you figure out to some small degree what the encryption is doing. After a while you can realize that the server encrypts in two character blocks, left padding with null bytes to ensure that the length is a multiple of two.</p> <p>We don&#39;t necessarily know the length of the flag, but it&#39;s fine since we can just decrypt right to left and either it&#39;ll be an even length or it&#39;ll be an odd length and we know the first character anyway since all flags are formatted as <code>flag&#123;&#125;</code>.</p> <p>Each two char block is encrypted by adding a constant value to the block depending on the ending char type &#40;digit, uppercase letter, lowercase letter, or &#123;&#125;&#41; and the value of the starter char.<sup id="fnref:1"><a href="#fndef:1" class=fnref >[1]</a></sup></p> <p>The server also has a silent rejection of certain characters. We can determine the set of &quot;allowed&quot; characters by querying every single byte value &#40;there&#39;s only 256 anyway&#41; to determine that there are 64 allowed chars:</p> <blockquote> <p>0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;</p> </blockquote> <p>To decrypt we can build a lookup table that matches each possible two char combination to its encrypted value and then matching the encryptions to the encrypted string. Doing this requires <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>63</mn><mo>×</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">63 \times 5</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >63</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >5</span></span></span></span> queries to the server of various starting char &#40;63&#41; &#43; end char type &#40;5&#41; combinations. We only need 63 starting chars since no group will ever start with <code>&#125;</code>.</p> <pre><code class="python hljs"><span class=hljs-keyword >import</span> time
<span class=hljs-keyword >from</span> pwn <span class=hljs-keyword >import</span> *
<span class=hljs-keyword >from</span> Crypto.Util.number <span class=hljs-keyword >import</span> bytes_to_long, long_to_bytes

idcs = []
standard_alph = []
encrypt_alph = []

<span class=hljs-keyword >def</span> <span class="hljs-title function_">is_same_type</span>(<span class=hljs-params >c1, c2</span>):
    <span class=hljs-keyword >if</span> c1.isnumeric() <span class=hljs-keyword >and</span> c2.isnumeric(): <span class=hljs-keyword >return</span> <span class=hljs-literal >True</span>
    <span class=hljs-keyword >if</span> c1.islower() <span class=hljs-keyword >and</span> c2.islower(): <span class=hljs-keyword >return</span> <span class=hljs-literal >True</span>
    <span class=hljs-keyword >if</span> c1.isupper() <span class=hljs-keyword >and</span> c2.isupper(): <span class=hljs-keyword >return</span> <span class=hljs-literal >True</span>
    <span class=hljs-keyword >if</span> c1 == c2: <span class=hljs-keyword >return</span> <span class=hljs-literal >True</span> <span class=hljs-comment ># handles the braces</span>
    <span class=hljs-keyword >return</span> <span class=hljs-literal >False</span>

<span class=hljs-comment ># i = 37</span>
<span class=hljs-comment ># while i &lt; 127:</span>
<span class=hljs-comment >#     p = remote(&#x27;54.85.45.101&#x27;, 8003)</span>
<span class=hljs-comment >#     to_send = chr(i)</span>
<span class=hljs-comment >#     p.sendline(to_send.encode(&quot;utf-8&quot;))</span>
<span class=hljs-comment >#     try:</span>
<span class=hljs-comment >#         r = p.recv()</span>
<span class=hljs-comment >#     except EOFError: # try again if this was the case.</span>
<span class=hljs-comment >#         p.close()</span>
<span class=hljs-comment >#         continue</span>
<span class=hljs-comment >#     p.close()</span>
<span class=hljs-comment >#     i += 1</span>

<span class=hljs-comment >#     # Not a valid flag char.</span>
<span class=hljs-comment >#     if r.startswith(b&quot;Invalid&quot;):</span>
<span class=hljs-comment >#         continue</span>
<span class=hljs-comment >#     # print(i, to_send, r)</span>

<span class=hljs-comment >#     idcs.append(i - 1)</span>
<span class=hljs-comment >#     standard_alph.append(to_send)</span>
<span class=hljs-comment >#     encrypt_alph.append(r.decode())</span>
<span class=hljs-comment >#     time.sleep(0.05) # Give the server a little break as a treat.</span>

<span class=hljs-comment ># diffs = [int(encrypt_alph[i], 16) - idcs[i] for i in range(len(idcs))]</span>
<span class=hljs-comment ># print(standard_alph)</span>
<span class=hljs-comment ># print(diffs)</span>

<span class=hljs-comment ># for i in range(len(diffs)):</span>
<span class=hljs-comment >#     print(standard_alph[i], encrypt_alph[i], diffs[i])</span>
<span class=hljs-comment ># Above code determined the standard alphabet and its differences, although we didn&#x27;t need it in the end.</span>

<span class=hljs-comment ># Remember that diffs is encrypt - ord(plain), plain = encrypt - diffs</span>
standard_alph = [<span class=hljs-string >&#x27;0&#x27;</span>, <span class=hljs-string >&#x27;1&#x27;</span>, <span class=hljs-string >&#x27;2&#x27;</span>, <span class=hljs-string >&#x27;3&#x27;</span>, <span class=hljs-string >&#x27;4&#x27;</span>, <span class=hljs-string >&#x27;5&#x27;</span>, <span class=hljs-string >&#x27;6&#x27;</span>, <span class=hljs-string >&#x27;7&#x27;</span>, <span class=hljs-string >&#x27;8&#x27;</span>, <span class=hljs-string >&#x27;9&#x27;</span>, <span class=hljs-string >&#x27;A&#x27;</span>, <span class=hljs-string >&#x27;B&#x27;</span>, <span class=hljs-string >&#x27;C&#x27;</span>, <span class=hljs-string >&#x27;D&#x27;</span>, <span class=hljs-string >&#x27;E&#x27;</span>, <span class=hljs-string >&#x27;F&#x27;</span>, <span class=hljs-string >&#x27;G&#x27;</span>, <span class=hljs-string >&#x27;H&#x27;</span>, <span class=hljs-string >&#x27;I&#x27;</span>, <span class=hljs-string >&#x27;J&#x27;</span>, <span class=hljs-string >&#x27;K&#x27;</span>, <span class=hljs-string >&#x27;L&#x27;</span>, <span class=hljs-string >&#x27;M&#x27;</span>, <span class=hljs-string >&#x27;N&#x27;</span>, <span class=hljs-string >&#x27;O&#x27;</span>, <span class=hljs-string >&#x27;P&#x27;</span>, <span class=hljs-string >&#x27;Q&#x27;</span>, <span class=hljs-string >&#x27;R&#x27;</span>, <span class=hljs-string >&#x27;S&#x27;</span>, <span class=hljs-string >&#x27;T&#x27;</span>, <span class=hljs-string >&#x27;U&#x27;</span>, <span class=hljs-string >&#x27;V&#x27;</span>, <span class=hljs-string >&#x27;W&#x27;</span>, <span class=hljs-string >&#x27;X&#x27;</span>, <span class=hljs-string >&#x27;Y&#x27;</span>, <span class=hljs-string >&#x27;Z&#x27;</span>, <span class=hljs-string >&#x27;a&#x27;</span>, <span class=hljs-string >&#x27;b&#x27;</span>, <span class=hljs-string >&#x27;c&#x27;</span>, <span class=hljs-string >&#x27;d&#x27;</span>, <span class=hljs-string >&#x27;e&#x27;</span>, <span class=hljs-string >&#x27;f&#x27;</span>, <span class=hljs-string >&#x27;g&#x27;</span>, <span class=hljs-string >&#x27;h&#x27;</span>, <span class=hljs-string >&#x27;i&#x27;</span>, <span class=hljs-string >&#x27;j&#x27;</span>, <span class=hljs-string >&#x27;k&#x27;</span>, <span class=hljs-string >&#x27;l&#x27;</span>, <span class=hljs-string >&#x27;m&#x27;</span>, <span class=hljs-string >&#x27;n&#x27;</span>, <span class=hljs-string >&#x27;o&#x27;</span>, <span class=hljs-string >&#x27;p&#x27;</span>, <span class=hljs-string >&#x27;q&#x27;</span>, <span class=hljs-string >&#x27;r&#x27;</span>, <span class=hljs-string >&#x27;s&#x27;</span>, <span class=hljs-string >&#x27;t&#x27;</span>, <span class=hljs-string >&#x27;u&#x27;</span>, <span class=hljs-string >&#x27;v&#x27;</span>, <span class=hljs-string >&#x27;w&#x27;</span>, <span class=hljs-string >&#x27;x&#x27;</span>, <span class=hljs-string >&#x27;y&#x27;</span>, <span class=hljs-string >&#x27;z&#x27;</span>, <span class=hljs-string >&#x27;{&#x27;</span>, <span class=hljs-string >&#x27;}&#x27;</span>]
diffs = [<span class=hljs-number >4</span>, <span class=hljs-number >4</span>, <span class=hljs-number >4</span>, <span class=hljs-number >4</span>, <span class=hljs-number >4</span>, <span class=hljs-number >4</span>, <span class=hljs-number >4</span>, <span class=hljs-number >4</span>, <span class=hljs-number >4</span>, <span class=hljs-number >4</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >39</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >97</span>, -<span class=hljs-number >61</span>, -<span class=hljs-number >62</span>]

double_dict = {}
<span class=hljs-comment ># Unfortunately have to test ending on &quot;}&quot;</span>
end_chars = [<span class=hljs-string >&quot;0&quot;</span>, <span class=hljs-string >&quot;A&quot;</span>, <span class=hljs-string >&quot;a&quot;</span>, <span class=hljs-string >&quot;{&quot;</span>, <span class=hljs-string >&quot;}&quot;</span>]

diff = <span class=hljs-number >0</span>
<span class=hljs-comment ># Don&#x27;t need to go all the way to the end since two char strings will never start with } in the flag</span>
<span class=hljs-keyword >for</span> c1 <span class=hljs-keyword >in</span> standard_alph[:-<span class=hljs-number >1</span>]:
    <span class=hljs-keyword >for</span> c2 <span class=hljs-keyword >in</span> end_chars:
        p = remote(<span class=hljs-string >&#x27;54.85.45.101&#x27;</span>, <span class=hljs-number >8003</span>)
        to_send = c1 + c2
        p.sendline(to_send.encode(<span class=hljs-string >&quot;utf-8&quot;</span>))
        <span class=hljs-keyword >try</span>:
            r = p.recv()
        <span class=hljs-keyword >except</span> EOFError: <span class=hljs-comment ># try again if this was the case.</span>
            p.close()
            <span class=hljs-keyword >continue</span>
        p.close()

        <span class=hljs-comment ># Not a valid flag char.</span>
        <span class=hljs-keyword >if</span> r.startswith(<span class=hljs-string >b&quot;Invalid&quot;</span>):
            <span class=hljs-keyword >continue</span>

        val = bytes_to_long(to_send.encode(<span class=hljs-string >&quot;utf-8&quot;</span>))
        received = <span class=hljs-built_in >int</span>(r.decode(), <span class=hljs-number >16</span>)
        diff = received - val <span class=hljs-comment ># encrypt - pt</span>

        <span class=hljs-comment ># Now generate the dict for everything with that starter char and end char combo</span>
        <span class=hljs-comment ># Since the diff is constant within end char types</span>
        <span class=hljs-keyword >for</span> c3 <span class=hljs-keyword >in</span> standard_alph:
            <span class=hljs-keyword >if</span> <span class=hljs-keyword >not</span> is_same_type(c2, c3): <span class=hljs-keyword >continue</span>
            to_send = c1 + c3
            val = bytes_to_long(to_send.encode(<span class=hljs-string >&quot;utf-8&quot;</span>))
            double_dict[<span class=hljs-built_in >hex</span>(val + diff)[<span class=hljs-number >2</span>:]] = to_send

        time.sleep(<span class=hljs-number >0.05</span>) <span class=hljs-comment ># Give the server a little break as a treat.</span>

ct = <span class=hljs-string >&quot;052c01be88c7f52cbdc3c084c7b1313828034370034dd13778342dff&quot;</span>
pt = <span class=hljs-string >&quot;&quot;</span>

<span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-built_in >range</span>(<span class=hljs-built_in >len</span>(ct) - <span class=hljs-number >3</span>, <span class=hljs-number >0</span>, -<span class=hljs-number >3</span>):
    pt = double_dict[ct[i:(i + <span class=hljs-number >3</span>)]] + pt
<span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;f&quot;</span> + pt)

<span class=hljs-comment ># flag{ImF1ll3dWithSte4kandCann0tD4nc3}</span></code></pre> <table class=fndef  id="fndef:1"> <tr> <td class=fndef-backref ><a href="#fnref:1">[1]</a> <td class=fndef-content >After the conclusion of the CTF I realized that the encryption was an addition and a multiplication combined, and we could have done this with a significantly fewer amount of queries. </table> <h2 id=wheres_my_key_150_pts ><a href="#wheres_my_key_150_pts" class=header-anchor >Where&#39;s My Key? &#40;150 pts&#41;</a></h2> <blockquote> <p>The flag server is providing encrypted flags. It looks like there might be a bug in the code and I can&#39;t figure out how to decrypt it.</p> </blockquote> <p>I did this challenge last, because on first glance it looked quite tricky. In reality it was actually very straightforward due to the simple fact that the server doesn&#39;t do any sort of input sanitization.</p> <p>The server implements a very straightforward <a href="https://en.wikipedia.org/wiki/Elliptic-curve_Diffie&#37;E2&#37;80&#37;93Hellman">Elliptic Curve Diffie-Hellman &#40;ECDH&#41;</a> key exchange scheme, using Curve25519.<sup id="fnref:2"><a href="#fndef:2" class=fnref >[2]</a></sup> ECDH is almost identical to normal Diffie-Helman, substituting math over an elliptic curve rather than an integer ring. Briefly for ECDH, suppose we have two cryptologists Andy and Becky. Andy and Becky each generate their private key, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span>, which in this case are just integers. In order to safely share their keys, and calculate a shared secret, Andy shares <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>a</mi><mo>∗</mo><mi>G</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(a * G)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">a</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class=mclose >)</span></span></span></span> to Becky, while Becky shares <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>b</mi><mo>∗</mo><mi>G</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(b * G)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">b</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class=mclose >)</span></span></span></span> to Andy. The two can then each &#40;independently&#41; calculate the shared secret <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>a</mi><mo>∗</mo><mi>b</mi><mo>∗</mo><mi>G</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(a * b * G)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">a</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class=mclose >)</span></span></span></span>. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span> here, in ECDH, refers to the generator point used for the chosen elliptic curve.</p> <p>The security of ECDH is linked to the difficulty of calculating the &quot;elliptic curve discrete logarithm problem.&quot; That is to say, given <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>a</mi><mo>∗</mo><mi>G</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(a * G)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">a</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class=mclose >)</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span> it is difficult to impossible to calculate the value of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>. Thus an interceptor who receives <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>a</mi><mo>∗</mo><mi>G</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(a * G)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">a</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class=mclose >)</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>b</mi><mo>∗</mo><mi>G</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(b * G)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">b</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class=mclose >)</span></span></span></span> cannot calculate the shared secret <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>a</mi><mo>∗</mo><mi>b</mi><mo>∗</mo><mi>G</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(a * b * G)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">a</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class=mclose >)</span></span></span></span> from these values.</p> <p>In this challenge the server accepts your public key <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>a</mi><mo>∗</mo><mi>G</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(a * G)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">a</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class=mclose >)</span></span></span></span>, then calculates its own private and public keys as well as the shared secret. In &quot;standard&quot; ECDH the server is then supposed to share its public key, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>b</mi><mo>∗</mo><mi>G</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(b * G)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">b</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class=mclose >)</span></span></span></span> with you, but due to a &#40;intentional&#41; bug in the code it does not, so you have no way of knowing the shared secret... or do you? More on this in a second.</p> <p>The server then uses the shared secret as the key in an AES encryption in CTR &#40;counter&#41; mode with a random initialization vector &#40;IV&#41;. The server then gives you the encrypted flag and the IV, with the assumption that you know the key. The exact mode for the AES encryption here is only relevant as far as we need to know what it is for decryption, given the key.</p> <p>The problem is then basically solved if you know the shared secret. One approach is to try and reconstruct the shared secret, but the server uses a random private key every time. An alternative method is if you can somehow <em>force</em> the server to have a specific shared secret then you also win. As foreshadowed before the server does not do any input sanitization or validation. Note, then, if you generate your ECDH private key as a string of null bytes, such that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a = 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">a</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0</span></span></span></span> then the shared secret <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>∗</mo><mi>b</mi><mo>∗</mo><mi>G</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a * b * G = 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4653em;"></span><span class="mord mathnormal">a</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0</span></span></span></span>. Knowing this and the returned IV and ciphertext you can decrypt the flag.</p> <pre><code class="python hljs"><span class=hljs-keyword >import</span> json

<span class=hljs-keyword >from</span> pwn <span class=hljs-keyword >import</span> *
<span class=hljs-keyword >from</span> cryptography.hazmat.primitives.ciphers <span class=hljs-keyword >import</span> Cipher, algorithms, modes

X25519_KEY_SIZE = <span class=hljs-number >32</span>
<span class=hljs-comment ># null bytes * anything = null bytes :)</span>
<span class=hljs-comment ># hence secret will be null bytes</span>
client_pub = <span class=hljs-built_in >bytes</span>(X25519_KEY_SIZE)

p = remote(<span class=hljs-string >&#x27;54.85.45.101&#x27;</span>, <span class=hljs-number >8001</span>)

to_send = {<span class=hljs-string >&quot;client_pub&quot;</span>: client_pub.<span class=hljs-built_in >hex</span>()}
p.sendline(json.dumps(to_send).encode())

r = p.recv().decode(<span class=hljs-string >&quot;utf-8&quot;</span>)
d = json.loads(r)
<span class=hljs-built_in >print</span>(d)

iv = <span class=hljs-built_in >bytes</span>.fromhex(d[<span class=hljs-string >&quot;iv&quot;</span>])
ct = <span class=hljs-built_in >bytes</span>.fromhex(d[<span class=hljs-string >&quot;ct&quot;</span>])

cipher = Cipher(algorithms.AES(client_pub), modes.CTR(iv))
decryptor = cipher.decryptor()
pt = decryptor.update(ct) + decryptor.finalize()

<span class=hljs-built_in >print</span>(pt)

<span class=hljs-comment ># flag{0000_wh0_knew_pub_keys_c0uld_be_bad_0000}</span></code></pre> <table class=fndef  id="fndef:2"> <tr> <td class=fndef-backref ><a href="#fnref:2">[2]</a> <td class=fndef-content >This key exchange/curve combination is typically referred to as x25519. </table> <h2 id=glitch_in_the_crypt_exploiting_faulty_rsa_decryption_200_pts ><a href="#glitch_in_the_crypt_exploiting_faulty_rsa_decryption_200_pts" class=header-anchor >Glitch in the Crypt: Exploiting Faulty RSA Decryption &#40;200 pts&#41;</a></h2> <blockquote> <p>A high-security server, SecureVault Inc., uses RSA encryption to protect sensitive data. The server utilizes a 1024-bit RSA key and employs the CRT optimization during decryption to improve performance. Due to a hardware fault, the server occasionally introduces errors during the decryption process. Specifically, the fault affects the computation of m<em>p &#61; c^&#123;d</em>p&#125; mod p during the CRT step, causing m<em>p to be incorrect, while m</em>q &#61; c^&#123;d_q&#125; mod q remains correct. As an experienced cryptanalyst, you have managed to obtain access to the server&#39;s decryption service. Your goal is to exploit the faulty decryption results to recover the prime factors p and q of the RSA modulus n, effectively breaking the encryption scheme and recovering the private key.</p> </blockquote> <p>The challenge description above essentially outlines exactly how to solve this challenge. The server is a standard RSA decryption oracle that has a 10&#37; chance to introduce a fault into the <a href="https://en.wikipedia.org/wiki/RSA_&#40;cryptosystem&#41;#Using_the_Chinese_remainder_algorithm">CRT reconstruction</a> when decrypting RSA.</p> <p>Section 2.1 of the paper <a href="https://dl.ifip.org/db/conf/wistp/wistp2007/KimQ07.pdf">Fault Attacks for CRT Based RSA: New Attacks, New Results, and New Countermeasures</a> outlines the solution to the challenge although with a few mathematical steps skipped that I will outline below.</p> <p>To decrypt a message in base RSA we calculate</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>m</mi><mo>=</mo><msup><mi>c</mi><mi>d</mi></msup><mtext> mod </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex"> m = c^d ~\text{mod}~ n </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8991em;"></span><span class=mord ><span class="mord mathnormal">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord text"><span class=mord >mod</span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">n</span></span></span></span></span> <p>.</p> <p>The CRT allows us to compute the value mod <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> by instead computing the decryptions in the subgroups mod <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> and mod <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>. The math to do this is slightly more involved, first computing the decryption exponents in the subgroups:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>d</mi><mi>p</mi></msub><mo>=</mo><mi>d</mi><mtext> mod </mtext><mo stretchy=false >(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> d_p = d ~\text{mod}~ (p-1) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.9805em;vertical-align:-0.2861em;"></span><span class=mord ><span class="mord mathnormal">d</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mspace nobreak"> </span><span class="mord text"><span class=mord >mod</span></span><span class="mspace nobreak"> </span><span class=mopen >(</span><span class="mord mathnormal">p</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mclose >)</span></span></span></span></span> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>d</mi><mi>q</mi></msub><mo>=</mo><mi>d</mi><mtext> mod </mtext><mo stretchy=false >(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> d_q = d ~\text{mod}~ (q-1) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.9805em;vertical-align:-0.2861em;"></span><span class=mord ><span class="mord mathnormal">d</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mspace nobreak"> </span><span class="mord text"><span class=mord >mod</span></span><span class="mspace nobreak"> </span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mclose >)</span></span></span></span></span> <p>As well as the inverse of q in the p group:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>q</mi><mrow><mi>i</mi><mi>n</mi><mi>v</mi></mrow></msub><mo>=</mo><msup><mi>q</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mtext> mod </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex"> q_{inv} = q^{-1} ~\text{mod}~ p</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.0585em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord text"><span class=mord >mod</span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">p</span></span></span></span></span> <p>Then using the CRT, using notation that matches both Wikipedia and the challenge script:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>m</mi><mn>1</mn></msub><mo>=</mo><msup><mi>c</mi><msub><mi>d</mi><mi>p</mi></msub></msup><mtext> mod </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex"> m_1 = c^{d_p} ~\text{mod}~ p </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.0935em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord text"><span class=mord >mod</span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">p</span></span></span></span></span> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>m</mi><mn>2</mn></msub><mo>=</mo><msup><mi>c</mi><msub><mi>d</mi><mi>q</mi></msub></msup><mtext> mod </mtext><mi>q</mi></mrow><annotation encoding="application/x-tex"> m_2 = c^{d_q} ~\text{mod}~ q </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.0935em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord text"><span class=mord >mod</span></span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></span> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>h</mi><mo>=</mo><msub><mi>q</mi><mrow><mi>i</mi><mi>n</mi><mi>v</mi></mrow></msub><mo stretchy=false >(</mo><msub><mi>m</mi><mn>1</mn></msub><mo>−</mo><msub><mi>m</mi><mn>2</mn></msub><mo stretchy=false >)</mo><mtext> mod </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex"> h = q_{inv}(m_1 - m_2) ~\text{mod}~ p</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class="mspace nobreak"> </span><span class="mord text"><span class=mord >mod</span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">p</span></span></span></span></span> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>m</mi><mo>=</mo><msub><mi>m</mi><mn>2</mn></msub><mo>+</mo><mi>h</mi><mi>q</mi></mrow><annotation encoding="application/x-tex"> m = m_2 + hq </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.7333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></span> <p>This is pretty standard CRT, given the modulus of the message in <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span> we thus compute the modulus of the message in mod <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mi>p</mi><mi>q</mi></mrow><annotation encoding="application/x-tex">n = pq</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">pq</span></span></span></span> in the last line. For small messages, this is actually slower than just directly calculating the decryption in mod <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>, but for large messages this is faster or more memory efficient.</p> <p>A fault attack necessitates a mistake in calculating either <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">m_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> or <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">m_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, such that we do not correctly calculate the decryption in that subgroup. In this specific challenge the server simulates a fault in calculating <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">m_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. A fault in <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">m_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, in this notation, would actually be harder to detect and crack, although with respect to the first point the server alerts you that a fault occurred &#40;it would have been perhaps more interesting if it had not&#41;.</p> <p>What happens when <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">m_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is calculated incorrectly? Consider taking the difference of two different decryptions, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> of the same original ciphertext:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>m</mi><mi>A</mi></msub><mo>−</mo><msub><mi>m</mi><mi>B</mi></msub><mo>=</mo><msub><mi>m</mi><mrow><mn>2</mn><mo separator=true >,</mo><mi>A</mi></mrow></msub><mo>+</mo><msub><mi>h</mi><mi>A</mi></msub><mi>q</mi><mo>−</mo><msub><mi>m</mi><mrow><mn>2</mn><mo separator=true >,</mo><mi>B</mi></mrow></msub><mo>−</mo><msub><mi>h</mi><mi>B</mi></msub><mi>q</mi><mo>=</mo><mn>0</mn><mo stretchy=false >?</mo></mrow><annotation encoding="application/x-tex"> m_A - m_B = m_{2,A} + h_A q - m_{2, B} - h_B q = 0?</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8694em;vertical-align:-0.2861em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">A</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">h</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8694em;vertical-align:-0.2861em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">h</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6944em;"></span><span class=mord >0</span><span class=mclose >?</span></span></span></span></span> <p>If both decryptions are the same, with no faults, then this value is obviously equal to zero. However, consider that there is a fault in <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">m_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> &#40;but not <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">m_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>&#41;:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>m</mi><mi>A</mi></msub><mo>−</mo><msub><mi>m</mi><mi>B</mi></msub><mo>=</mo><msub><mi>h</mi><mi>A</mi></msub><mi>q</mi><mo>−</mo><msub><mi>h</mi><mi>B</mi></msub><mi>q</mi><mo>=</mo><mo stretchy=false >(</mo><msub><mi>h</mi><mi>A</mi></msub><mo>−</mo><msub><mi>h</mi><mi>B</mi></msub><mo stretchy=false >)</mo><mi>q</mi></mrow><annotation encoding="application/x-tex"> m_A - m_B = h_A q - h_B q = (h_A - h_B) q </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">h</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">h</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">h</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal">h</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></span> <p>This value is proportional to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>&#33; It should be clear then that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mi>C</mi><mi>D</mi><mo stretchy=false >(</mo><msub><mi>m</mi><mi>A</mi></msub><mo>−</mo><msub><mi>m</mi><mi>B</mi></msub><mo separator=true >,</mo><mi>N</mi><mo stretchy=false >)</mo><mo>=</mo><mi>q</mi><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">GCD(m_A - m_B, N) = q,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">GC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=mpunct >,</span></span></span></span><sup id="fnref:3"><a href="#fndef:3" class=fnref >[3]</a></sup> with <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> following from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mi>N</mi><mi mathvariant=normal >/</mi><mi>q</mi></mrow><annotation encoding="application/x-tex">p = N / q</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class=mord >/</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>. Knowing <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span> we can easily reconstruct <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span> and perform the decryption ourself&#33;</p> <pre><code class="python hljs"><span class=hljs-keyword >from</span> pwn <span class=hljs-keyword >import</span> *
<span class=hljs-keyword >import</span> os
<span class=hljs-keyword >import</span> math
<span class=hljs-keyword >from</span> Crypto.Util.number <span class=hljs-keyword >import</span> bytes_to_long, long_to_bytes

p = remote(<span class=hljs-string >&#x27;54.85.45.101&#x27;</span>, <span class=hljs-number >8010</span>)

<span class=hljs-built_in >print</span>(p.recvuntil(<span class=hljs-string >b&quot;format:\n&quot;</span>))
<span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;sending&quot;</span>)
p.sendline(<span class=hljs-string >b&quot;flag&quot;</span>) <span class=hljs-comment ># Want to get how many bytes it is.</span>

r = p.recvline()
ct = <span class=hljs-built_in >int</span>(r.decode().strip().split(<span class=hljs-string >&quot; &quot;</span>)[-<span class=hljs-number >1</span>][<span class=hljs-number >2</span>:], <span class=hljs-number >16</span>)
<span class=hljs-built_in >print</span>(ct)

r = p.recvline()
n_bytes = <span class=hljs-built_in >int</span>(r.decode().split(<span class=hljs-string >&quot; &quot;</span>)[-<span class=hljs-number >1</span>])
<span class=hljs-built_in >print</span>(n_bytes)


<span class=hljs-built_in >print</span>(p.recvuntil(<span class=hljs-string >b&quot;format:\n&quot;</span>))
to_send = os.urandom(n_bytes).<span class=hljs-built_in >hex</span>()
p.sendline(to_send.encode(<span class=hljs-string >&quot;utf-8&quot;</span>))

r = p.recvline()
<span class=hljs-built_in >print</span>(r.decode().strip().split(<span class=hljs-string >&quot; &quot;</span>)[-<span class=hljs-number >1</span>][<span class=hljs-number >2</span>:])
dc = <span class=hljs-built_in >int</span>(r.decode().strip().split(<span class=hljs-string >&quot; &quot;</span>)[-<span class=hljs-number >1</span>][<span class=hljs-number >2</span>:], <span class=hljs-number >16</span>)

dc_fault = <span class=hljs-number >0</span>
s = p.recvuntil(<span class=hljs-string >b&quot;format:\n&quot;</span>)

<span class=hljs-comment ># We will proceed by sending the same string over and over until there is a fault</span>
<span class=hljs-comment ># We could also get unlucky and there&#x27;s a fault in the first try so we must account for that</span>
faulted_first = <span class=hljs-literal >False</span>
<span class=hljs-keyword >if</span> <span class=hljs-string >b&quot;Fault&quot;</span> <span class=hljs-keyword >in</span> s:
    faulted_first = <span class=hljs-literal >True</span>
    <span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Faulted first&quot;</span>)

<span class=hljs-comment ># 1/10 chance of faulting means in 20 tries we should for sure fault.</span>
<span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-built_in >range</span>(<span class=hljs-number >20</span>):
    p.sendline(to_send.encode(<span class=hljs-string >&quot;utf-8&quot;</span>))
    r = p.recvline()
    dc_fault = <span class=hljs-built_in >int</span>(r.decode().strip().split(<span class=hljs-string >&quot; &quot;</span>)[-<span class=hljs-number >1</span>][<span class=hljs-number >2</span>:], <span class=hljs-number >16</span>)

    s = p.recvuntil(<span class=hljs-string >b&quot;format:\n&quot;</span>)
    <span class=hljs-keyword >if</span> (<span class=hljs-string >b&quot;Fault&quot;</span> <span class=hljs-keyword >in</span> s) <span class=hljs-keyword >or</span> (<span class=hljs-keyword >not</span> (<span class=hljs-string >b&quot;Fault&quot;</span> <span class=hljs-keyword >in</span> s) <span class=hljs-keyword >and</span> faulted_first):
        <span class=hljs-keyword >break</span>

N = <span class=hljs-number >30392456691103520456566703629789883376981975074658985351907533566054217142999128759248328829870869523368987496991637114688552687369186479700671810414151842146871044878391976165906497019158806633675101</span>
e = <span class=hljs-number >65537</span>

q = math.gcd(dc - dc_fault, N)
<span class=hljs-built_in >print</span>(q)
p = N // q
<span class=hljs-built_in >print</span>(p)
phi = (q - <span class=hljs-number >1</span>) * (p - <span class=hljs-number >1</span>)
d = <span class=hljs-built_in >pow</span>(e, -<span class=hljs-number >1</span>, phi)

pt = <span class=hljs-built_in >pow</span>(ct, d, N)
<span class=hljs-built_in >print</span>(q)
<span class=hljs-built_in >print</span>(long_to_bytes(pt))

<span class=hljs-comment ># flag{cr4ck1ng_RS4_w1th_f4ul7s}</span></code></pre> <table class=fndef  id="fndef:3"> <tr> <td class=fndef-backref ><a href="#fnref:3">[3]</a> <td class=fndef-content >Assuming that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mi>A</mi></msub><mo>&gt;</mo><msub><mi>m</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">m_A &gt; m_B</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6891em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >&gt;</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, simply swap the two if it is not. </table> <h2 id=conclusion ><a href="#conclusion" class=header-anchor >Conclusion</a></h2> <p>We ended up placing 30th, and for a brief moment I was the MVP with my crypto clear although that was deposed in the last few hours of the challenge. Alas, perhaps next time.</p> <div class=page-foot > <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Dylan Green. Last modified: December 16, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div>